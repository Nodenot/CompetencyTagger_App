define(["jquery","core/ajax"],(function(e,l){var t={init:function(l){e("select#id_anchor").on("change",t.selectAnchorChanged),t.lastSelAnchor=null,t.lastSelAnchorId=null,t.lastSelAnchorRef=null,t.colourText="#FE6847",t.cmid=null,t.courseid=null,t.blockid=null,t.addrServer=l,e(window).on("load",t.loadIframe)},lastSelAnchor:null,lastSelAnchorId:null,lastSelAnchorRef:null,colourText:null,cmid:null,courseid:null,blockid:null,selectAnchorChanged:function(){if(e("select#id_anchor").val()!==t.lastSelAnchor&&"-"!==e("select#id_anchor").val()){if(null!==t.lastSelAnchorRef)document.getElementById(t.lastSelAnchorRef).style="";t.lastSelAnchor=e("select#id_anchor").val(),data=t.lastSelAnchor.split("#_#"),t.lastSelAnchorId=data[0],t.lastSelAnchorRef=data[1],t.cmid=e("input#id_cmid").val(),t.courseid=e("input#id_courseid").val(),t.blockid=e("input#id_blockid").val(),e("#ros_ul li").each((function(l,o){var n=e(o),c=n.attr("id").split("#_#");n.attr("hidden",!0),c[1]==t.lastSelAnchorId&&(n.attr("hidden",!1),n.on("dblclick",(function(){let l=document.getElementById("graph_course_"+t.courseid),o={client_id:l.name,message:"anchor_"+c[0]};e.post(t.addrServer+"/api/sigma/setRoToLink",o),l.scrollIntoView({behavior:"smooth",block:"start"})})))}));var l=document.getElementById("iut_page_newtab_icon");l.href="view.php?id="+t.cmid+"#"+t.lastSelAnchorRef,l.target="_blank",l.style="cursor:pointer;",document.getElementById(t.lastSelAnchorRef).style="color:"+t.colourText+"; font-style: oblique; text-decoration: underline;";var o=document.getElementById("iut_page_editname_icon");o.href="/moodle/blocks/cosy_ct/anchor_visor.php?id="+t.cmid+"&courseid="+t.courseid+"&blockid="+t.blockid+"&anchorid="+t.lastSelAnchorId,o.style="cursor:pointer; color: #1177d1;",window.onbeforeunload=null}},loadIframe:function(){if(t.cmid=e("input#id_cmid").val(),t.courseid=e("input#id_courseid").val(),!document.getElementById("graph_course_"+t.courseid)){let l=document.createElement("iframe");l.setAttribute("src",t.addrServer+"/index.html?gid="+t.courseid+"&cid="+t.cmid),l.setAttribute("allow","fullscreen"),l.style.width="100%",l.style.height="500px",l.frameBorder=1,l.id="graph_course_"+t.courseid,window.onmessage=function(e){e.data.startsWith("ifrmsckt_")&&(l.name=e.data.split("ifrmsckt_")[1])},e("#topofscroll").append(l)}}};return t}));